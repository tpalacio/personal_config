# Switch me back to ^A, thanks
set-option -g prefix C-a
unbind-key C-b
bind-key a send-prefix

# easy way to source this .tmux.conf file
bind R source-file ~/.tmux.conf \; display-message "Config reloaded..."

# I miss ^A^A and ^ASpace
bind-key C-a last-window
bind-key Space next-window
bind-key C-Space previous-window
bind-key | split-window -h -c '~/'
bind-key \\ split-window -h -c '~/'
bind-key - split-window -v -c '~/'
bind-key _ split-window -v -c '~/'
# This will remove the repeat option for changing split windows when the arrow is hit more than once
unbind-key C-Up
unbind-key C-Down
unbind-key C-Left
unbind-key C-Right
bind-key Up    select-pane -U
bind-key Down  select-pane -D
bind-key Left  select-pane -L
bind-key Right select-pane -R
bind-key C-p   select-pane -U
bind-key C-n   select-pane -D
bind-key C-b   select-pane -L
bind-key C-f   select-pane -R

# Options
set-option -sg escape-time 50  # this makes vim fucking awful to use
set-option -g base-index 1 # start numbering windows at 1 # seems to only work on older version of tmux
setw -g pane-base-index 1 # start windows and panes at 1
# set-option -g default-terminal screen-256color
set-option -g default-terminal "xterm"
set-option -g lock-command vlock
set-window-option -g xterm-keys on  # to make ctrl-arrow, etc. work

set-option -g set-titles on
set-option -g set-titles-string '[#S:#I #H] #W'  # use screen title

set -g status-left '' #removes admin status
set -g status-right '' #removes session address and date/time

set -g history-limit 50000

set -g display-panes-time 2000 # extend the display time 2 secs; bind-key q

# setw -g monitor-activity on
set -g visual-activity on

# set-option -g mouse-select-pane on

# COLORS.
# To match solarized dark theme (local)
# otherwise Orange theme -- for server distinction
if-shell "uname | grep -q Darwin" " \
set-option -g status-style bg=colour023,fg=colour0 ; \
set-window-option -g window-status-current-style fg=colour015,bg=colour006" " \
set-option -g status-style bg=colour172,fg=colour0 ; \
set-window-option -g window-status-current-style fg=colour015,bg=colour166"
# Left shows the session name, in blue
set-option -g status-left-style bg=default,fg=colour74
# Right is some CPU stats, so terminal green
set-option -g status-right-style bg=default,fg=colour234
# Windows are medium gray; current window is white
set-window-option -g window-status-style fg=colour233
# color active pane (when using split panes)
set-option -g pane-active-border-style fg=green

# change the order of windows by moving the current window
unbind-key ,    ;     bind-key , swap-window -d -t -1
unbind-key .    ;     bind-key . swap-window -d -t +1

setw -g mode-keys emacs #set keys to emacs # not sure if this works or is necessary, might already use emacs keys

# enter copy mode; continue using M-Up to scroll up half a page or use pgUp to scroll up full pages
bind-key M-Up copy-mode

# Windows renumbered if one closes
set-option -g renumber-windows on #feature is not available in the tmux version currently installed

#split window into 4
# bind-key ` split-window -h -p 66 \; send-keys 'vsql' 'Enter' C-l \; split-window -h -p 50 \; select-pane -t 1 \; split-window -v -p 50 \; select-pane -t 0

bind-key V split-window -v \; send-keys 'WIDTH=$(tput cols) && dw_root -X -c "select pid, trim(usename) as "usename", query_start as start_time, age(clock_timestamp(), query_start) as duration, query as sql from pg_stat_activity where query != \$\$<IDLE>\$\$ and query not ilike \$\$%pg_stat_activity%\$\$ order by duration;" > ~/dw_processes.tmp && clear && less ~/dw_processes.tmp && logout' 'Enter'

bind-key S split-window -h -c '~/' \; send-keys './postgres_describe_table.sh ; logout' 'Enter'

bind-key T split-window -h -c '~/' \; send-keys 'cddbt ; tail -n 10000 -f ../logs/dbt.log ; logout' 'Enter'

bind-key j command-prompt -p "join pane from:"  "join-pane -h -s ':%%'"

bind-key @ command-prompt -p "send pane to:"  "join-pane -h -t ':%%'"

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'laktak/extrakto'

# Other examples:
# set -g @plugin 'github_username/plugin_name'
# set -g @plugin 'git@github.com:user/plugin'
# set -g @plugin 'git@bitbucket.com:user/plugin'

# continuum: saves and restores sessions automatically
# set restore overrides for resurrect
# set -g @resurrect-processes 'nano emacsclient "\"emacsclient -nw\"->emacsclient -nw"'
# set -g @resurrect-processes ':all: "~emacsclient->emacsclient -nw"'
set -g @resurrect-processes ':all:'

# enable continuum restore feature
set -g @continuum-restore 'on'
# automatically start tmx after a system reboot
set -g @continuum-boot 'on'
# enable fzf path: only needed for linux server
if-shell "uname | grep -q Linux" " \
set -g @extrakto_fzf_tool '/home/thoren/.fzf/bin/fzf'"

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
